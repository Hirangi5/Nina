{"version":3,"file":"index.module.mjs","sources":["../src/constants.ts","../src/utils.ts","../src/session.ts","../src/ui/components/Notification.tsx","../src/ui/notifications.tsx","../src/ui/assets/mobile.svg","../src/service.ts","../src/fcl-wc.ts"],"sourcesContent":["export enum FLOW_METHODS {\n  FLOW_AUTHN = \"flow_authn\",\n  FLOW_PRE_AUTHZ = \"flow_pre_authz\",\n  FLOW_AUTHZ = \"flow_authz\",\n  FLOW_USER_SIGN = \"flow_user_sign\",\n}\n\nexport enum REQUEST_TYPES {\n  SESSION_REQUEST = \"session_proposal\",\n  SIGNING_REQUEST = \"signing_request\",\n}\n\nexport const SERVICE_PLUGIN_NAME = \"fcl-plugin-service-walletconnect\"\nexport const WC_SERVICE_METHOD = \"WC/RPC\"\n","import {log, LEVELS} from \"@onflow/util-logger\"\nimport * as fclCore from \"@onflow/fcl-core\"\nimport {FLOW_METHODS, WC_SERVICE_METHOD} from \"./constants\"\nimport {Service} from \"@onflow/typedefs\"\n\nconst PRE_AUTHZ_SERVICE_TYPE = \"pre-authz\"\n\nconst makeFlowServicesFromWallets = (wallets: any[]) => {\n  return Object.values(wallets)\n    .filter(w => w.app_type === \"wallet\")\n    .map(wallet => {\n      return {\n        f_type: \"Service\",\n        f_vsn: \"1.0.0\",\n        type: \"authn\",\n        method: \"WC/RPC\",\n        uid: wallet.mobile?.universal,\n        endpoint: \"flow_authn\",\n        optIn: true,\n        provider: {\n          address: null,\n          name: wallet.name,\n          icon: wallet.image_url?.sm,\n          description: wallet.description,\n          website: wallet.homepage,\n          color: wallet.metadata?.colors?.primary,\n          supportEmail: null,\n        },\n      }\n    })\n}\n\nexport const fetchFlowWallets = async (projectId: string) => {\n  try {\n    const network = await fclCore.getChainId()\n    const wcApiWallets = await fetch(\n      `https://explorer-api.walletconnect.com/v3/wallets?projectId=${projectId}&chains=flow:${network}&entries=5&page=1`\n    ).then(res => res.json())\n\n    if (wcApiWallets?.count > 0) {\n      return makeFlowServicesFromWallets(wcApiWallets.listings)\n    }\n\n    return []\n  } catch (error) {\n    if (error instanceof Error) {\n      log({\n        title: `${error.name} Error fetching wallets from WalletConnect API`,\n        message: error.message,\n        level: LEVELS.error,\n      })\n    }\n  }\n}\n\nexport function isAndroid() {\n  return (\n    typeof navigator !== \"undefined\" && /android/i.test(navigator.userAgent)\n  )\n}\n\nexport function isSmallIOS() {\n  return (\n    typeof navigator !== \"undefined\" && /iPhone|iPod/.test(navigator.userAgent)\n  )\n}\n\nexport function isLargeIOS() {\n  return typeof navigator !== \"undefined\" && /iPad/.test(navigator.userAgent)\n}\n\nexport function isIOS() {\n  return isSmallIOS() || isLargeIOS()\n}\n\nexport function isMobile() {\n  return isAndroid() || isIOS()\n}\n\nexport function openDeeplink(url: string) {\n  if (url.startsWith(\"http\")) {\n    // Workaround for https://github.com/rainbow-me/rainbowkit/issues/524.\n    // Using 'window.open' causes issues on iOS in non-Safari browsers and\n    // WebViews where a blank tab is left behind after connecting.\n    // This is especially bad in some WebView scenarios (e.g. following a\n    // link from Twitter) where the user doesn't have any mechanism for\n    // closing the blank tab.\n    // For whatever reason, links with a target of \"_blank\" don't suffer\n    // from this problem, and programmatically clicking a detached link\n    // element with the same attributes also avoids the issue.\n    const link = document.createElement(\"a\")\n    link.href = url\n    link.target = \"_blank\"\n    link.rel = \"noreferrer noopener\"\n    link.click()\n  } else {\n    window.open(url, \"_blank\")\n  }\n}\n\nexport function shouldDeepLink({service, user}: {service: Service; user: any}) {\n  // Only deeplink on mobile\n  if (!isMobile()) return false\n\n  // If this is an authn request, the user has already been deeplinked by connectWc\n  if (service.endpoint === FLOW_METHODS.FLOW_AUTHN) return false\n\n  // If there was a pre-authz WC request, the user has already been deeplinked\n  if (\n    service.endpoint === FLOW_METHODS.FLOW_AUTHZ &&\n    user?.services?.find(\n      (s: Service) =>\n        s.method === WC_SERVICE_METHOD && s.type === PRE_AUTHZ_SERVICE_TYPE\n    )\n  )\n    return false\n\n  return true\n}\n\nexport function preloadImage(url?: string | null) {\n  if (!url) return\n  const img = new Image()\n  img.src = url\n}\n","import * as fclCore from \"@onflow/fcl-core\"\nimport {FLOW_METHODS} from \"./constants\"\nimport {SignClient} from \"@walletconnect/sign-client/dist/types/client\"\nimport {PairingTypes, SessionTypes} from \"@walletconnect/types\"\n\n// Create a new session proposal with the WalletConnect client\nexport async function createSessionProposal({\n  client,\n  existingPairing,\n}: {\n  client: SignClient\n  existingPairing?: PairingTypes.Struct\n}) {\n  const network = await fclCore.getChainId()\n\n  const requiredNamespaces = {\n    flow: {\n      methods: [\n        FLOW_METHODS.FLOW_AUTHN,\n        FLOW_METHODS.FLOW_PRE_AUTHZ,\n        FLOW_METHODS.FLOW_AUTHZ,\n        FLOW_METHODS.FLOW_USER_SIGN,\n      ],\n      chains: [`flow:${network}`],\n      events: [\"chainChanged\", \"accountsChanged\"],\n    },\n  }\n\n  const {uri, approval} = await client.connect({\n    pairingTopic: existingPairing?.topic,\n    requiredNamespaces,\n  })\n\n  if (!uri) {\n    throw new Error(\n      \"FCL-WC: Error creating session proposal. Could not create a proposal URI.\"\n    )\n  }\n\n  return {uri, approval}\n}\n\nexport const request = async ({\n  method,\n  body,\n  session,\n  client,\n  abortSignal,\n}: {\n  method: any\n  body: any\n  session: SessionTypes.Struct\n  client: SignClient\n  abortSignal?: AbortSignal\n}) => {\n  const [chainId, addr, address] = makeSessionData(session)\n  const data = JSON.stringify({...body, addr, address})\n\n  const result: any = await Promise.race([\n    client.request({\n      topic: session.topic,\n      chainId,\n      request: {\n        method,\n        params: [data],\n      },\n    }),\n    new Promise((_, reject) => {\n      if (abortSignal?.aborted) {\n        reject(new Error(\"WalletConnect Request aborted\"))\n      }\n      abortSignal?.addEventListener(\"abort\", () => {\n        reject(new Error(\"WalletConnect Request aborted\"))\n      })\n    }),\n  ])\n\n  if (typeof result !== \"object\" || result == null) return\n\n  switch (result.status) {\n    case \"APPROVED\":\n      return result.data\n\n    case \"DECLINED\":\n      throw new Error(`Declined: ${result.reason || \"No reason supplied\"}`)\n\n    case \"REDIRECT\":\n      return result.data\n\n    default:\n      throw new Error(`Declined: No reason supplied`)\n  }\n}\n\nexport function makeSessionData(session: SessionTypes.Struct) {\n  const [namespace, reference, address] = Object.values<any>(session.namespaces)\n    .map(namespace => namespace.accounts)\n    .flat()\n    .filter(account => account.startsWith(\"flow:\"))[0]\n    .split(\":\")\n\n  const chainId = `${namespace}:${reference}`\n  const addr = address\n  return [chainId, addr, address]\n}\n","import {NotificationInfo} from \"../../types/types\"\nimport {isMobile} from \"../../utils\"\n\nexport function Notification({\n  title,\n  message,\n  icon,\n  onClick,\n  onDismiss,\n  animate,\n}: NotificationInfo & {animate?: boolean}) {\n  return (\n    <div\n      className={`fixed bottom-3 left-3 right-3 mx-auto z-[2147483647] flex max-w-sm\n        overflow-hidden rounded-lg border border-gray-200 bg-white p-4 shadow-lg\n        md:bottom-4 md:left-auto md:right-4 dark:bg-gray-700 dark:border-gray-600\n        ${animate ? \"animate-slideUp\" : \"\"}`}\n      role=\"alert\"\n      onClick={e => {\n        if (onClick) {\n          e.stopPropagation()\n          onClick?.()\n        }\n      }}\n    >\n      {icon && (\n        <img\n          className=\"h-10 w-10 self-center rounded-md md:self-start\"\n          src={icon}\n          alt={title}\n        />\n      )}\n      <div className=\"ml-3 grow\">\n        <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n          {title}\n        </p>\n        <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-300\">\n          {message}\n        </p>\n      </div>\n\n      <button\n        className={`ml-2 inline-flex rounded-full text-gray-400 hover:text-gray-500 focus:ring-0\n          dark:text-gray-200 dark:hover:text-gray-300 ${\n          isMobile()\n              ? \"self-center p-2\"\n              : \"self-start p-0 bg-transparent border-transparent focus:border-transparent\"\n          }`}\n        onClick={e => {\n          e.stopPropagation()\n          onDismiss?.()\n        }}\n      >\n        <span className=\"sr-only\">Close</span>\n        <svg\n          className={\"h-5 w-5\"}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 20 20\"\n          fill=\"currentColor\"\n          aria-hidden=\"true\"\n        >\n          <path\n            fillRule=\"evenodd\"\n            d=\"M14.354 5.646a.5.5 0 00-.708 0L10 9.293 5.354 4.646a.5.5 0 00-.708.708L9.293 10l-4.647 4.646a.5.5 0 00.708.708L10 10.707l4.646 4.647a.5.5 0 00.708-.708L10.707 10l4.647-4.646a.5.5 0 000-.708z\"\n          />\n        </svg>\n      </button>\n    </div>\n  )\n}\n","import {render} from \"preact\"\nimport styles from \"./styles.css\"\nimport {Notification} from \"./components/Notification\"\nimport {NotificationInfo} from \"../types/types\"\n\nlet renderRoot: HTMLElement | null = null\nlet id = 0\nlet dismissTimeout: NodeJS.Timeout | null = null\n\nfunction createRenderRoot() {\n  const shadowHost = document.createElement(\"div\")\n  const shadowRoot = shadowHost.attachShadow({mode: \"open\"})\n  const container = document.createElement(\"div\")\n\n  shadowRoot.appendChild(container)\n  document.body.appendChild(shadowHost)\n\n  const style = document.createElement(\"style\")\n  style.textContent = styles\n  shadowRoot.appendChild(style)\n\n  // Subscribe to root dark mode changes to inherit the theme\n  const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\")\n  const listener = () => {\n    container.classList.toggle(\"dark\", mediaQuery.matches)\n  }\n  mediaQuery.addEventListener(\"change\", listener)\n  listener()\n\n  return container\n}\n\n/**\n * Show a notification to the user.  Only one notification can be shown at a time and will replace any existing notification.\n */\nexport function showNotification({\n  title,\n  message,\n  icon,\n  onClick,\n  onDismiss,\n  debounceDelay = 0,\n}: NotificationInfo & {debounceDelay?: number}): {dismiss: () => void} {\n  if (!renderRoot) {\n    renderRoot = createRenderRoot()\n  }\n\n  // Don't animate if we are replacing an existing notification\n  const animate = !dismissTimeout\n  if (dismissTimeout) {\n    clearTimeout(dismissTimeout)\n    dismissTimeout = null\n  }\n\n  render(\n    <Notification\n      key={id++}\n      title={title}\n      message={message}\n      icon={icon}\n      onClick={onClick}\n      onDismiss={() => {\n        onDismiss?.()\n        dismissUi()\n      }}\n      animate={animate}\n    />,\n    renderRoot\n  )\n\n  function dismissUi() {\n    if (renderRoot) {\n      render(null, renderRoot)\n    }\n  }\n\n  return {\n    dismiss: () => {\n      // We need to delay the dismiss to debounce any subsequent notifications\n      // This is important when there is both a FCL/WC authz and pre-authz service\n      dismissTimeout = setTimeout(() => {\n        dismissTimeout = null\n        dismissUi()\n      }, debounceDelay)\n    },\n  }\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3e%3c!--!Font Awesome Free 6.7.1 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons%2c Inc.--%3e%3cpath d='M16 64C16 28.7 44.7 0 80 0L304 0c35.3 0 64 28.7 64 64l0 384c0 35.3-28.7 64-64 64L80 512c-35.3 0-64-28.7-64-64L16 64zM224 448a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM304 64L80 64l0 320 224 0 0-320z'/%3e%3c/svg%3e\";\n  export default img;","import {invariant} from \"@onflow/util-invariant\"\nimport {log, LEVELS} from \"@onflow/util-logger\"\nimport {isMobile, openDeeplink, preloadImage, shouldDeepLink} from \"./utils\"\nimport {\n  REQUEST_TYPES,\n  SERVICE_PLUGIN_NAME,\n  WC_SERVICE_METHOD,\n} from \"./constants\"\nimport {SignClient} from \"@walletconnect/sign-client/dist/types/client\"\nimport {createSessionProposal, request} from \"./session\"\nimport {ModalCtrlState} from \"@walletconnect/modal-core/dist/_types/src/types/controllerTypes\"\nimport {showNotification} from \"./ui/notifications\"\nimport type {FclWalletConnectConfig} from \"./fcl-wc\"\nimport mobileIcon from \"./ui/assets/mobile.svg\"\nimport {CurrentUser, Service} from \"@onflow/typedefs\"\nimport {SessionTypes} from \"@walletconnect/types\"\n\ntype WalletConnectModalType = import(\"@walletconnect/modal\").WalletConnectModal\n\ntype Constructor<T> = new (...args: any[]) => T\n\nexport const makeServicePlugin = (\n  client: Promise<SignClient | null>,\n  config: FclWalletConnectConfig = {\n    projectId: \"\",\n    includeBaseWC: false,\n    wallets: [],\n    wcRequestHook: null,\n    pairingModalOverride: null,\n    disableNotifications: false,\n  }\n) => ({\n  name: SERVICE_PLUGIN_NAME,\n  f_type: \"ServicePlugin\",\n  type: \"discovery-service\",\n  serviceStrategy: {\n    method: WC_SERVICE_METHOD,\n    exec: makeExec(\n      client,\n      config,\n      import(\"@walletconnect/modal\").then(m => m.WalletConnectModal)\n    ),\n  },\n  services: [],\n})\n\nconst makeExec = (\n  clientPromise: Promise<SignClient | null>,\n  config: FclWalletConnectConfig,\n  WalletConnectModal: Promise<Constructor<WalletConnectModalType>>\n) => {\n  return async ({\n    service,\n    body,\n    opts,\n    abortSignal,\n    user,\n  }: {\n    service: any\n    body: any\n    opts: any\n    abortSignal?: AbortSignal\n    user: any\n  }) => {\n    // Preload provider image\n    preloadImage(service.provider?.icon)\n\n    const {\n      wcRequestHook,\n      pairingModalOverride,\n      disableNotifications: appDisabledNotifications,\n    } = config\n\n    const client = await clientPromise\n    invariant(!!client, \"WalletConnect is not initialized\")\n\n    let session: SessionTypes.Struct | null = null,\n      pairing: any\n    const method = service.endpoint\n    const appLink = validateAppLink(service)\n    const pairings = client.pairing.getAll({active: true})\n\n    if (pairings.length > 0) {\n      pairing = pairings?.find(p => p.peerMetadata?.url === service.uid)\n    }\n\n    if (client.session.length > 0) {\n      const lastKeyIndex = client.session.keys.length - 1\n      session = client.session.get(client.session.keys.at(lastKeyIndex)!)\n    }\n\n    if (session == null) {\n      session = await new Promise<SessionTypes.Struct>((resolve, reject) => {\n        function onClose() {\n          reject(`Declined: Externally Halted`)\n        }\n\n        connectWc(WalletConnectModal)({\n          service,\n          onClose,\n          appLink,\n          client,\n          method,\n          pairing,\n          wcRequestHook,\n          pairingModalOverride,\n          abortSignal,\n        }).then(resolve, reject)\n      })\n    }\n\n    if (wcRequestHook && wcRequestHook instanceof Function) {\n      wcRequestHook({\n        type: REQUEST_TYPES.SIGNING_REQUEST,\n        method,\n        service,\n        session: session ?? null,\n        pairing: pairing ?? null,\n        uri: null,\n      })\n    }\n\n    // Deeplink to the wallet app if necessary\n    if (shouldDeepLink({service, user})) {\n      openDeeplink(appLink)\n    }\n\n    // Show notification to the user if not disabled by app developer or wallet\n    const walletDisabledNotifications =\n      session?.sessionProperties?.[\"fclWc.disableNotificationsOnMobile\"] ===\n      \"true\"\n\n    const notification =\n      !appDisabledNotifications && !walletDisabledNotifications\n        ? showWcRequestNotification({\n            user,\n            service,\n          })\n        : null\n\n    // Make request to the WalletConnect client and return the result\n    return await request({\n      method,\n      body,\n      session,\n      client,\n      abortSignal,\n    }).finally(() => notification?.dismiss())\n\n    function validateAppLink({uid}: {uid: string}) {\n      if (!(uid && /^(ftp|http|https):\\/\\/[^ \"]+$/.test(uid))) {\n        log({\n          title: \"WalletConnect Service Warning\",\n          message: `service.uid should be a valid universal link url. Found: ${uid}`,\n          level: LEVELS.warn,\n        })\n      }\n      return uid\n    }\n  }\n}\n\n// Connect to WalletConnect directly from the browser via deep link or WalletConnectModal\nfunction connectWc(\n  WalletConnectModal: Promise<Constructor<WalletConnectModalType>>\n) {\n  return async ({\n    service,\n    onClose,\n    appLink,\n    client,\n    method,\n    pairing,\n    wcRequestHook,\n    pairingModalOverride,\n    abortSignal,\n  }: {\n    service: any\n    onClose: any\n    appLink: string\n    client: SignClient\n    method: string\n    pairing: any\n    wcRequestHook: any\n    pairingModalOverride: any\n    abortSignal?: AbortSignal\n  }): Promise<SessionTypes.Struct> => {\n    const projectId = client.opts?.projectId\n    invariant(\n      !!projectId,\n      \"Cannot establish connection, WalletConnect projectId is undefined\"\n    )\n\n    let _uri: string | null = null,\n      walletConnectModal: WalletConnectModalType | null = null\n\n    try {\n      const {uri, approval} = await createSessionProposal({\n        client,\n        existingPairing: pairing,\n      })\n      _uri = uri\n\n      if (wcRequestHook && wcRequestHook instanceof Function) {\n        wcRequestHook({\n          type: REQUEST_TYPES.SESSION_REQUEST,\n          method,\n          service,\n          session: null,\n          pairing: pairing ?? null,\n          uri: uri ?? null,\n        })\n      }\n\n      if (isMobile()) {\n        const queryString = new URLSearchParams({uri: uri}).toString()\n        let url = pairing == null ? appLink + \"?\" + queryString : appLink\n        openDeeplink(url)\n      } else if (!pairing) {\n        if (!pairingModalOverride) {\n          walletConnectModal = new (await WalletConnectModal)({\n            projectId,\n          })\n\n          // Open WalletConnectModal\n          walletConnectModal.openModal({\n            uri,\n            onClose,\n          })\n\n          // Subscribe to modal state changes\n          const unsubscribeModal = walletConnectModal.subscribeModal(\n            (state: ModalCtrlState) => {\n              if (state.open === false) {\n                onClose?.()\n                unsubscribeModal()\n              }\n            }\n          )\n        } else {\n          pairingModalOverride(uri, onClose)\n        }\n      }\n\n      const session = await Promise.race([\n        approval(),\n        new Promise<never>((_, reject) => {\n          if (abortSignal?.aborted) {\n            reject(new Error(\"Session request aborted\"))\n          }\n          abortSignal?.addEventListener(\"abort\", () => {\n            reject(new Error(\"Session request aborted\"))\n          })\n        }),\n      ])\n      return session\n    } catch (error) {\n      if (error instanceof Error) {\n        log({\n          title: `${error.name} Error establishing WalletConnect session`,\n          message: `\n          ${error.message}\n          uri: ${_uri}\n        `,\n          level: LEVELS.error,\n        })\n      }\n      onClose()\n      throw error\n    } finally {\n      walletConnectModal?.closeModal()\n    }\n  }\n}\n\n/**\n * Show a notification for a WalletConnect request.\n * @param service - The service that is requesting the user's attention.\n * @param user - The user that is being requested to sign a transaction.\n * @returns A close function to dismiss the notification.\n */\nexport function showWcRequestNotification({\n  service,\n  user,\n}: {\n  service: Service\n  user: CurrentUser\n}) {\n  const authnService = user?.services?.find((s: any) => s.type === \"authn\")\n  const walletProvider = authnService?.provider || service.provider\n\n  return showNotification({\n    title: walletProvider?.name || \"Mobile Wallet\",\n    message: isMobile()\n      ? \"Tap to view request in app\"\n      : \"Pending request on your mobile device\",\n    icon: walletProvider?.icon || mobileIcon,\n    onClick:\n      isMobile() && service.uid ? () => openDeeplink(service.uid!) : undefined,\n    debounceDelay: service.type === \"pre-authz\" ? 500 : 0,\n  })\n}\n","import * as fclCore from \"@onflow/fcl-core\"\nimport SignClient from \"@walletconnect/sign-client\"\nimport {invariant} from \"@onflow/util-invariant\"\nimport {LEVELS, log} from \"@onflow/util-logger\"\nexport {getSdkError} from \"@walletconnect/utils\"\nimport {makeServicePlugin} from \"./service\"\nimport {CoreTypes} from \"@walletconnect/types\"\n\nexport interface FclWalletConnectConfig {\n  projectId: string\n  metadata?: CoreTypes.Metadata\n  includeBaseWC?: boolean\n  wcRequestHook?: any\n  pairingModalOverride?: any\n  wallets?: any[]\n  disableNotifications?: boolean\n}\n\nconst DEFAULT_RELAY_URL = \"wss://relay.walletconnect.com\"\nconst DEFAULT_LOGGER = \"debug\"\nlet clientPromise: Promise<SignClient | null> = Promise.resolve(null)\n\nconst initClient = async ({\n  projectId,\n  metadata,\n}: {\n  projectId: string\n  metadata?: CoreTypes.Metadata\n}) => {\n  invariant(\n    projectId != null,\n    \"FCL Wallet Connect Error: WalletConnect projectId is required\"\n  )\n  try {\n    return SignClient.init({\n      logger: DEFAULT_LOGGER,\n      relayUrl: DEFAULT_RELAY_URL,\n      projectId: projectId,\n      metadata: metadata,\n    })\n  } catch (error) {\n    if (error instanceof Error) {\n      log({\n        title: `${error.name} fcl-wc Init Client`,\n        message: error.message,\n        level: LEVELS.error,\n      })\n    }\n    throw error\n  }\n}\n\nexport const initLazy = (config: FclWalletConnectConfig) => {\n  const {FclWcServicePlugin, clientPromise} = initHelper(config)\n  fclCore.discovery.authn.update()\n\n  return {\n    FclWcServicePlugin,\n    clientPromise,\n  }\n}\n\nexport const init = async (config: FclWalletConnectConfig) => {\n  const {FclWcServicePlugin, clientPromise} = initLazy(config)\n  const client = await clientPromise\n  fclCore.discovery.authn.update()\n\n  return {\n    FclWcServicePlugin,\n    client,\n  }\n}\n\nconst initHelper = (config: FclWalletConnectConfig) => {\n  if (typeof window === \"undefined\") {\n    throw new Error(\n      \"FCL Wallet Connect Plugin can only be initialized in the browser\"\n    )\n  }\n\n  // Lazy load the SignClient\n  //  - Initialize the client if it doesn't exist\n  //  - If it does exist, return existing client\n  //  - If existing client fails to initialize, reinitialize\n  clientPromise = Promise.resolve(clientPromise)\n    .catch(() => null)\n    .then(_client => {\n      if (_client) {\n        return _client\n      } else {\n        return initClient({\n          projectId: config.projectId,\n          metadata: config.metadata,\n        })\n      }\n    })\n    .catch(e => {\n      log({\n        title: `WalletConnect Client Initialization Error`,\n        message: e.message ? e.message : e,\n        level: LEVELS.error,\n      })\n      throw e\n    })\n\n  const FclWcServicePlugin = makeServicePlugin(clientPromise, config)\n\n  return {\n    FclWcServicePlugin,\n    clientPromise,\n  }\n}\n\n// Returns the SignClient instance used by this plugin if it has been initialized\nexport async function getSignClient() {\n  return clientPromise.then(client => {\n    if (!client) {\n      throw new Error(\"WalletConnect client not initialized\")\n    }\n\n    return client\n  })\n}\n\nexport {SERVICE_PLUGIN_NAME} from \"./constants\"\n"],"names":["FLOW_METHODS","REQUEST_TYPES","SERVICE_PLUGIN_NAME","WC_SERVICE_METHOD","PRE_AUTHZ_SERVICE_TYPE","isAndroid","navigator","test","userAgent","isSmallIOS","isLargeIOS","isIOS","isMobile","openDeeplink","url","startsWith","link","document","createElement","href","target","rel","click","window","open","shouldDeepLink","_ref","service","user","endpoint","FLOW_AUTHN","FLOW_AUTHZ","services","find","s","method","type","preloadImage","img","Image","src","createSessionProposal","client","existingPairing","network","fclCore","getChainId","requiredNamespaces","flow","methods","FLOW_PRE_AUTHZ","FLOW_USER_SIGN","chains","events","uri","approval","connect","pairingTopic","topic","Error","request","_ref2","body","session","abortSignal","chainId","addr","address","makeSessionData","data","JSON","stringify","result","Promise","race","params","_","reject","aborted","addEventListener","status","reason","namespace","reference","Object","values","namespaces","map","accounts","flat","filter","account","split","Notification","title","message","icon","onClick","onDismiss","animate","_jsxs","className","role","e","stopPropagation","children","_jsx","alt","xmlns","viewBox","fill","fillRule","d","renderRoot","id","dismissTimeout","createRenderRoot","shadowHost","shadowRoot","attachShadow","mode","container","appendChild","style","textContent","styles","mediaQuery","matchMedia","listener","classList","toggle","matches","showNotification","debounceDelay","clearTimeout","render","dismissUi","dismiss","setTimeout","makeServicePlugin","config","arguments","length","undefined","projectId","includeBaseWC","wallets","wcRequestHook","pairingModalOverride","disableNotifications","name","f_type","serviceStrategy","exec","makeExec","then","m","WalletConnectModal","clientPromise","opts","provider","appDisabledNotifications","invariant","pairing","appLink","validateAppLink","pairings","getAll","active","p","peerMetadata","uid","lastKeyIndex","keys","get","at","resolve","onClose","connectWc","Function","SIGNING_REQUEST","walletDisabledNotifications","sessionProperties","notification","showWcRequestNotification","finally","log","level","LEVELS","warn","_ref3","_uri","walletConnectModal","SESSION_REQUEST","queryString","URLSearchParams","toString","openModal","unsubscribeModal","subscribeModal","state","error","closeModal","_ref4","authnService","walletProvider","mobileIcon","DEFAULT_RELAY_URL","DEFAULT_LOGGER","initClient","metadata","SignClient","init","logger","relayUrl","initLazy","FclWcServicePlugin","initHelper","discovery","authn","update","catch","_client","getSignClient"],"mappings":"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"}